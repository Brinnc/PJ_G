<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내껨연습</title>
    <style>
        #wrapper {
            width: 500px;
            height: 900px;
            background: black;
            margin: auto;
        }

        #info {
            width: 100%;
            height: 100px;
            background: lightgray;
        }

        #stage {
            width: 100%;
            height: 800px;
            background-color: forestgreen;
            position: relative;
            overflow: hidden;
        }
    </style>
    <script src="lib.js"></script>
    <script src="GameObject.js"></script>
    <script src="Player.js"></script>
    <script src="HP.js"></script>
    <script src="Ramen.js"></script>
    <script src="MonsterBall.js"></script>
    <script src="Pokemon.js"></script>
    <script src="Boss.js"></script>
    <script src="Digimon.js"></script>
    <script>
        let info; //상단바
        let hp; //hp하트
        let stage; //게임화면
        let player; //플레이어 캐릭터
        let monsterBall; //총알
        let pokemon; //일반몬스터
        let boss; //보스몬스터
        let digimon; //함정몬스터
        let ramen; //hp포션

        let bgY = 0; //stage배경의 y축 값 변수

        let ballArray = []; //기본몬스터볼을 보관할 배열


        //포켓몬 이미지경로 배열
        let pokemonImg = ["po1.png", "po2.png", "po3.png", "po4.png", "po5.png", "po6.png", "po7.png", "po8.png", "po9.png", "po10.png",
                                     "po1.png", "po2.png", "po3.png", "po4.png", "po5.png", "po6.png", "po7.png", "po8.png", "po9.png", "po10.png"
                                    ];
        let pokemonArray = []; //포켓몬 인스턴스를 담는 배열

        let bossArray = []; //보스 인스턴스 배열

        //디지몬 이미지경로 배열
        let digimonImg = ["digi1.png", "digi2.png", "digi3.png"];
        let digimonArray = []; //디지몬 인스턴스를 담는 배열

        let flag = true;


        //1) 배경을 세팅함
        function setBG() {
            stage.style.background = "url(./images/bg1.jpg)";
            stage.style.backgroundSize = "500px 800px";
        }

        //1-1) 배경 움직이기, 위에서 아래로(y++)
        function bgEffect() {
            bgY = bgY + 1;
            stage.style.backgroundPosition = "0px " + bgY + "px";
        }

        //2) 플레이어 캐릭터 생성
        function createPlayer() {
            //container, src, width, height, x, y, velX, velY
            player = new Player(stage, "./images/rosa&roy_resize.png", 70, 80, 200, 720, 0, 0);
        }
        //2-1) 플레이어가 좌우로 이동
        function movePlayerX(n) {
            player.velX = n;
            //alert("왜 안눌러짐?");
        }

        //3) 몬스터볼 생성
        function ball() {
            //container, src, width, height, x, y, velX, velY
            monsterBall = new MonsterBall(stage, "./images/ball_basic.png", 20, 20, player.x + 70, player.y, 0, -10);

            //생성된 볼을 배열에 추가
            ballArray.push(monsterBall);
        }

        //4) 포켓몬 생성 
        //>> ★Q.스테이지 당 포켓몬을 정해놓고.....(ex.등장하는 종류는 5마리, 5마리가 반복해서 총 20마리가 나오게 할 경우)
        function createPokemon() {
            for (let i = 0; i < pokemonImg.length; i++) {
                //container, src, width, height, x, y, velX, velY
                //최초 등장시 랜덤한 x축값 위치
                pokemon = new Pokemon(stage, "./images/" + pokemonImg[i], 30, 30, getRandomByRange(10, 450), getRandomByRange(-500, 0), 0, 3);

                //생성된 포켓몬을 배열에 담기
                pokemonArray.push(pokemon);
            }
        }

        //7) 디~지~몬친구들, 디지몬도 돌게할까???
        function createDigimon() {
            for (let i = 0; i < digimonImg.length; i++) {
                //container, src, width, height, x, y, velX, velY
                digimon = new Digimon(stage, "./images/" + digimonImg[i], 30, 30, getRandomByRange(10, 450), getRandomByRange(-1000, 0), 0, 2);

                digimonArray.push(digimon);
            }
        }

        //언젠가쓰겠지속도조절함수
        function dropPokemon() {
            for (let i = 0; i < pokemonArray.length; i++) {
                pokemonArray[i].velY = 10;
            }
        }
        function dropDigimon() {
            for (let i = 0; i < digimonArray.length; i++) {
                digimonArray[i].velY = 10;
            }
        }


        //5) 보스 생성
        function createBoss() {
            //container, src, width, height, x, y, velX, velY
            //최초 등장시 랜덤한 x축값 위치
            //x축 왔다갔다..? 움직이도록 하려면
            //보스몬스터는 일반포켓몬이 다나오고 나서 나와야할텐데

            boss = new Boss(stage, "./images/boss1.png", 50, 50, getRandomByRange(10, 450), getRandomByRange(-1200, -1000), 0, 1);
            bossArray.push(boss);
        }

        //-) HP 생성해 상단바 인포에 표시
        function createHP() {
            for (let i = 1; i <= 7; i++) {
                //container, src, width, height, x, y, velX, velY
                hp = new HP(info, "./images/heart.png", 50, 50, i * 50, 50, 0, 0);

            }
        }

        //6) HP포션(컵라면) 생성
        function createRamen() {
            ramen = new Ramen(stage, "./images/ramen.png", 30, 30, getRandomByRange(10, 450), getRandomByRange(-1000, -800), 0, 4);
        }

        /*게임 일시정지*/
        function pause() {
            flag = !flag;
        }

        function init() {
            info = document.getElementById("info");
            stage = document.getElementById("stage");

            setBG();
            createHP();

            createPlayer();
            createPokemon();
            /*
            for (let i = 1; i <= 5; i++) {
                createPokemon();

            }
            */
            createBoss();
            createDigimon();

            createRamen();
        }

        function loop() {
            if (flag) {
                bgEffect();

                player.tick();
                player.render();

                //몬스터볼을 담은 배열로 tick()과 render()호출
                for (let i = 0; i < ballArray.length; i++) {
                    ballArray[i].tick();
                    ballArray[i].render();
                }

                //포켓몬의 tick()과 render()호출
                for (let i = 0; i < pokemonArray.length; i++) {
                    pokemonArray[i].tick();
                    pokemonArray[i].render();

                }

                //보스몬스터의 tick()과 render()호출
                bossArray[0].tick();
                bossArray[0].render();
                //for(let i = 0; i < bossArray.length; i++){}

                for (let i = 0; i < digimonArray.length; i++) {
                    digimonArray[i].tick();
                    digimonArray[i].render();

                }

                //hp라면의 tick()과 render()호출
                ramen.tick();
                ramen.render();
            }
        }

        addEventListener("load", function () {
            init();

            setInterval("loop()", 30);

            setInterval("boss.tick();", 100);

            //키보드 누를 때
            document.body.addEventListener("keydown", function (e) {
                switch (e.keyCode) {
                    case 37: movePlayerX(-8); break; //플레이어 좌, ←
                    case 39: movePlayerX(8); break; //플레이어 우, →

                    case 32: ball(); break; //볼 던지기, 스페이스

                    case 27: pause(); break; //게임스탑
                }
            });
            //키보드 뗄 때
            document.body.addEventListener("keyup", function (e) {
                switch (e.keyCode) {
                    case 37: movePlayerX(0); break; //플레이어 좌
                    case 39: movePlayerX(0); break; //플레이어 우
                }
            });
        });
    </script>
</head>

<body>
    <div id="wrapper">
        <div id="info">
            <span>STAGE 01</span>
        </div>
        <div id="stage"></div>
    </div>
</body>

</html>